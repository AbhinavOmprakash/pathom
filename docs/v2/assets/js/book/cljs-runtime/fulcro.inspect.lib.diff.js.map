{"version":3,"sources":["fulcro/inspect/lib/diff.cljc"],"mappings":"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","names":["cljs.spec.alpha/def-impl","cljs.core/map?","cljs.core/vector?","fulcro.inspect.lib.diff/updates","a","b","cljs.core.reduce.cljs$core$IFn$_invoke$arity$3","p__56008","vec__56009","cljs.core.nth.cljs$core$IFn$_invoke$arity$3","adds","k","v","va","cljs.core.get.cljs$core$IFn$_invoke$arity$3","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","fulcro.inspect.lib.diff/removals","p__56015","vec__56016","rems","temp__5718__auto__","vec__56019","_","vb","cljs.core/find","cljs.core.not_EQ_.cljs$core$IFn$_invoke$arity$2","childs","cljs.core/seq","cljs.core.conj.cljs$core$IFn$_invoke$arity$2","G__56022","fulcro.inspect.lib.diff/diff","fulcro.inspect.lib.diff/deep-merge","x","y","cljs.core.merge_with.cljs$core$IFn$_invoke$arity$variadic","p__56030","map__56031","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","fulcro.inspect.lib.diff/patch-updates","updates","p__56037","map__56038","fulcro.inspect.lib.diff/patch-removals","removals","final","rem","cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2","vec__56040","cljs.core/first","p1__56036#","cljs.core.update.cljs$core$IFn$_invoke$arity$3","G__56044","G__56045","fulcro.inspect.lib.diff/patch","diff"],"sourcesContent":["(ns fulcro.inspect.lib.diff\n  (:require [clojure.spec.alpha :as s]))\n\n(s/def ::updates map?)\n(s/def ::removals vector?)\n\n(defn updates [a b]\n  (reduce\n    (fn [adds [k v]]\n      (let [va (get a k ::unset)]\n        (if (= v va)\n          adds\n          (if (and (map? v) (map? va))\n            (assoc adds k (updates va v))\n            (assoc adds k v)))))\n    {}\n    b))\n\n(defn removals [a b]\n  (reduce\n    (fn [rems [k v]]\n      (if-let [[_ vb] (find b k)]\n        (if (and (map? v) (map? vb) (not= v vb))\n          (let [childs (removals v vb)]\n            (if (seq childs)\n              (conj rems {k childs})\n              rems))\n          rems)\n        (conj rems (cond-> k (map? k) (assoc ::key? true)))))\n    []\n    a))\n\n(defn diff [a b]\n  {::updates  (updates a b)\n   ::removals (removals a b)})\n\n(defn deep-merge [x y]\n  (if (and (map? x) (map? y))\n    (merge-with deep-merge x y)\n    y))\n\n(defn patch-updates [x {::keys [updates]}]\n  (merge-with deep-merge x updates))\n\n(defn patch-removals [x {::keys [removals]}]\n  (reduce\n    (fn [final rem]\n      (cond\n        (::key? rem)\n        (dissoc final (dissoc rem ::key?))\n\n        (map? rem)\n        (let [[k v] (first rem)]\n          (update final k #(patch-removals % {::removals v})))\n\n        :else\n        (dissoc final rem)))\n    x\n    removals))\n\n(defn patch [x diff]\n  (-> x\n      (patch-updates diff)\n      (patch-removals diff)))\n"]}