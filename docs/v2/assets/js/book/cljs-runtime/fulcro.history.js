goog.provide('fulcro.history');
goog.require('cljs.core');
goog.require('fulcro.logging');
goog.require('fulcro.util');
goog.require('clojure.set');
goog.require('cljs.spec.alpha');
fulcro.history.is_timestamp_QMARK_ = (function fulcro$history$is_timestamp_QMARK_(t){
return (t instanceof Date);
});
cljs.spec.alpha.def_impl(new cljs.core.Keyword("fulcro.history","max-size","fulcro.history/max-size",338795187),new cljs.core.Symbol("cljs.core","pos-int?","cljs.core/pos-int?",-2115888030,null),cljs.core.pos_int_QMARK_);
cljs.spec.alpha.def_impl(new cljs.core.Keyword("fulcro.history","db-before","fulcro.history/db-before",650457365),new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null),cljs.core.map_QMARK_);
cljs.spec.alpha.def_impl(new cljs.core.Keyword("fulcro.history","db-after","fulcro.history/db-after",-1774997361),new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null),cljs.core.map_QMARK_);
cljs.spec.alpha.def_impl(new cljs.core.Keyword("fulcro.history","client-time","fulcro.history/client-time",1879420278),new cljs.core.Symbol("fulcro.history","is-timestamp?","fulcro.history/is-timestamp?",-1658694055,null),fulcro.history.is_timestamp_QMARK_);
cljs.spec.alpha.def_impl(new cljs.core.Keyword("fulcro.history","tx","fulcro.history/tx",1485693993),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null),cljs.core.vector_QMARK_);
cljs.spec.alpha.def_impl(new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456),new cljs.core.Symbol("cljs.core","int?","cljs.core/int?",50730120,null),cljs.core.int_QMARK_);
cljs.spec.alpha.def_impl(new cljs.core.Keyword("fulcro.history","tx-result","fulcro.history/tx-result",-266551429),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"nil","nil",99600501),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"map","map",1371690461),new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null)),cljs.spec.alpha.or_spec_impl(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"nil","nil",99600501),new cljs.core.Keyword(null,"map","map",1371690461)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.nil_QMARK_,cljs.core.map_QMARK_], null),null));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("fulcro.history","network-sends","fulcro.history/network-sends",-234790789),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null)),cljs.spec.alpha.every_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","tuple","cljs.spec.alpha/tuple",-415901908,null),new cljs.core.Symbol(null,"keyword?","keyword?",1917797069,null),new cljs.core.Symbol(null,"vector?","vector?",-61367869,null)),cljs.spec.alpha.tuple_impl.cljs$core$IFn$_invoke$arity$2(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.keyword_QMARK_,cljs.core.vector_QMARK_], null)),new cljs.core.PersistentArrayMap(null, 7, [new cljs.core.Keyword(null,"into","into",-150836029),cljs.core.PersistentArrayMap.EMPTY,new cljs.core.Keyword("cljs.spec.alpha","kind-form","cljs.spec.alpha/kind-form",-1047104697),new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null),new cljs.core.Keyword("cljs.spec.alpha","cpred","cljs.spec.alpha/cpred",-693471218),(function (G__58307){
return cljs.core.map_QMARK_(G__58307);
}),new cljs.core.Keyword(null,"kind","kind",-717265803),cljs.core.map_QMARK_,new cljs.core.Keyword("cljs.spec.alpha","kfn","cljs.spec.alpha/kfn",672643897),(function (i__13227__auto__,v__13228__auto__){
return cljs.core.nth.cljs$core$IFn$_invoke$arity$2(v__13228__auto__,(0));
}),new cljs.core.Keyword("cljs.spec.alpha","conform-all","cljs.spec.alpha/conform-all",45201917),true,new cljs.core.Keyword("cljs.spec.alpha","describe","cljs.spec.alpha/describe",1883026911),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null))], null),null));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("fulcro.history","history-step","fulcro.history/history-step",-880117884),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","keys","cljs.spec.alpha/keys",1109346032,null),new cljs.core.Keyword(null,"req","req",-326448303),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","db-after","fulcro.history/db-after",-1774997361),new cljs.core.Keyword("fulcro.history","db-before","fulcro.history/db-before",650457365)], null),new cljs.core.Keyword(null,"opt","opt",-794706369),new cljs.core.PersistentVector(null, 5, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","tx","fulcro.history/tx",1485693993),new cljs.core.Keyword("fulcro.history","tx-result","fulcro.history/tx-result",-266551429),new cljs.core.Keyword("fulcro.client.impl.data-fetch","network-result","fulcro.client.impl.data-fetch/network-result",183682473),new cljs.core.Keyword("fulcro.history","network-sends","fulcro.history/network-sends",-234790789),new cljs.core.Keyword("fulcro.history","client-time","fulcro.history/client-time",1879420278)], null)),cljs.spec.alpha.map_spec_impl(cljs.core.PersistentHashMap.fromArrays([new cljs.core.Keyword(null,"req-un","req-un",1074571008),new cljs.core.Keyword(null,"opt-un","opt-un",883442496),new cljs.core.Keyword(null,"gfn","gfn",791517474),new cljs.core.Keyword(null,"pred-exprs","pred-exprs",1792271395),new cljs.core.Keyword(null,"keys-pred","keys-pred",858984739),new cljs.core.Keyword(null,"opt-keys","opt-keys",1262688261),new cljs.core.Keyword(null,"req-specs","req-specs",553962313),new cljs.core.Keyword(null,"req","req",-326448303),new cljs.core.Keyword(null,"req-keys","req-keys",514319221),new cljs.core.Keyword(null,"opt-specs","opt-specs",-384905450),new cljs.core.Keyword(null,"pred-forms","pred-forms",172611832),new cljs.core.Keyword(null,"opt","opt",-794706369)],[null,null,null,new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [(function (G__58337){
return cljs.core.map_QMARK_(G__58337);
}),(function (G__58337){
return cljs.core.contains_QMARK_(G__58337,new cljs.core.Keyword("fulcro.history","db-after","fulcro.history/db-after",-1774997361));
}),(function (G__58337){
return cljs.core.contains_QMARK_(G__58337,new cljs.core.Keyword("fulcro.history","db-before","fulcro.history/db-before",650457365));
})], null),(function (G__58337){
return ((cljs.core.map_QMARK_(G__58337)) && (cljs.core.contains_QMARK_(G__58337,new cljs.core.Keyword("fulcro.history","db-after","fulcro.history/db-after",-1774997361))) && (cljs.core.contains_QMARK_(G__58337,new cljs.core.Keyword("fulcro.history","db-before","fulcro.history/db-before",650457365))));
}),new cljs.core.PersistentVector(null, 5, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","tx","fulcro.history/tx",1485693993),new cljs.core.Keyword("fulcro.history","tx-result","fulcro.history/tx-result",-266551429),new cljs.core.Keyword("fulcro.client.impl.data-fetch","network-result","fulcro.client.impl.data-fetch/network-result",183682473),new cljs.core.Keyword("fulcro.history","network-sends","fulcro.history/network-sends",-234790789),new cljs.core.Keyword("fulcro.history","client-time","fulcro.history/client-time",1879420278)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","db-after","fulcro.history/db-after",-1774997361),new cljs.core.Keyword("fulcro.history","db-before","fulcro.history/db-before",650457365)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","db-after","fulcro.history/db-after",-1774997361),new cljs.core.Keyword("fulcro.history","db-before","fulcro.history/db-before",650457365)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","db-after","fulcro.history/db-after",-1774997361),new cljs.core.Keyword("fulcro.history","db-before","fulcro.history/db-before",650457365)], null),new cljs.core.PersistentVector(null, 5, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","tx","fulcro.history/tx",1485693993),new cljs.core.Keyword("fulcro.history","tx-result","fulcro.history/tx-result",-266551429),new cljs.core.Keyword("fulcro.client.impl.data-fetch","network-result","fulcro.client.impl.data-fetch/network-result",183682473),new cljs.core.Keyword("fulcro.history","network-sends","fulcro.history/network-sends",-234790789),new cljs.core.Keyword("fulcro.history","client-time","fulcro.history/client-time",1879420278)], null),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.list(new cljs.core.Symbol("cljs.core","fn","cljs.core/fn",-1065745098,null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"%","%",-950237169,null)], null),cljs.core.list(new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null),new cljs.core.Symbol(null,"%","%",-950237169,null))),cljs.core.list(new cljs.core.Symbol("cljs.core","fn","cljs.core/fn",-1065745098,null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"%","%",-950237169,null)], null),cljs.core.list(new cljs.core.Symbol("cljs.core","contains?","cljs.core/contains?",-976526835,null),new cljs.core.Symbol(null,"%","%",-950237169,null),new cljs.core.Keyword("fulcro.history","db-after","fulcro.history/db-after",-1774997361))),cljs.core.list(new cljs.core.Symbol("cljs.core","fn","cljs.core/fn",-1065745098,null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"%","%",-950237169,null)], null),cljs.core.list(new cljs.core.Symbol("cljs.core","contains?","cljs.core/contains?",-976526835,null),new cljs.core.Symbol(null,"%","%",-950237169,null),new cljs.core.Keyword("fulcro.history","db-before","fulcro.history/db-before",650457365)))], null),new cljs.core.PersistentVector(null, 5, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","tx","fulcro.history/tx",1485693993),new cljs.core.Keyword("fulcro.history","tx-result","fulcro.history/tx-result",-266551429),new cljs.core.Keyword("fulcro.client.impl.data-fetch","network-result","fulcro.client.impl.data-fetch/network-result",183682473),new cljs.core.Keyword("fulcro.history","network-sends","fulcro.history/network-sends",-234790789),new cljs.core.Keyword("fulcro.history","client-time","fulcro.history/client-time",1879420278)], null)])));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("fulcro.history","history-steps","fulcro.history/history-steps",1960379620),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Symbol("cljs.core","int?","cljs.core/int?",50730120,null),new cljs.core.Keyword("fulcro.history","history-step","fulcro.history/history-step",-880117884)),cljs.spec.alpha.every_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","tuple","cljs.spec.alpha/tuple",-415901908,null),new cljs.core.Symbol(null,"int?","int?",1799729645,null),new cljs.core.Keyword("fulcro.history","history-step","fulcro.history/history-step",-880117884)),cljs.spec.alpha.tuple_impl.cljs$core$IFn$_invoke$arity$2(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol("cljs.core","int?","cljs.core/int?",50730120,null),new cljs.core.Keyword("fulcro.history","history-step","fulcro.history/history-step",-880117884)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.int_QMARK_,new cljs.core.Keyword("fulcro.history","history-step","fulcro.history/history-step",-880117884)], null)),new cljs.core.PersistentArrayMap(null, 7, [new cljs.core.Keyword(null,"into","into",-150836029),cljs.core.PersistentArrayMap.EMPTY,new cljs.core.Keyword("cljs.spec.alpha","kind-form","cljs.spec.alpha/kind-form",-1047104697),new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null),new cljs.core.Keyword("cljs.spec.alpha","cpred","cljs.spec.alpha/cpred",-693471218),(function (G__58433){
return cljs.core.map_QMARK_(G__58433);
}),new cljs.core.Keyword(null,"kind","kind",-717265803),cljs.core.map_QMARK_,new cljs.core.Keyword("cljs.spec.alpha","kfn","cljs.spec.alpha/kfn",672643897),(function (i__13227__auto__,v__13228__auto__){
return cljs.core.nth.cljs$core$IFn$_invoke$arity$2(v__13228__auto__,(0));
}),new cljs.core.Keyword("cljs.spec.alpha","conform-all","cljs.spec.alpha/conform-all",45201917),true,new cljs.core.Keyword("cljs.spec.alpha","describe","cljs.spec.alpha/describe",1883026911),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Symbol("cljs.core","int?","cljs.core/int?",50730120,null),new cljs.core.Keyword("fulcro.history","history-step","fulcro.history/history-step",-880117884))], null),null));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("fulcro.history","active-remotes","fulcro.history/active-remotes",-1858379711),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Symbol("cljs.core","pos-int?","cljs.core/pos-int?",-2115888030,null),new cljs.core.Symbol("cljs.core","pos-int?","cljs.core/pos-int?",-2115888030,null))),cljs.spec.alpha.every_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","tuple","cljs.spec.alpha/tuple",-415901908,null),new cljs.core.Symbol(null,"keyword?","keyword?",1917797069,null),cljs.core.list(new cljs.core.Symbol("s","map-of","s/map-of",-1464752791,null),new cljs.core.Symbol(null,"pos-int?","pos-int?",-1205815015,null),new cljs.core.Symbol(null,"pos-int?","pos-int?",-1205815015,null))),cljs.spec.alpha.tuple_impl.cljs$core$IFn$_invoke$arity$2(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Symbol("cljs.core","pos-int?","cljs.core/pos-int?",-2115888030,null),new cljs.core.Symbol("cljs.core","pos-int?","cljs.core/pos-int?",-2115888030,null))], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.keyword_QMARK_,cljs.spec.alpha.every_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","tuple","cljs.spec.alpha/tuple",-415901908,null),new cljs.core.Symbol(null,"pos-int?","pos-int?",-1205815015,null),new cljs.core.Symbol(null,"pos-int?","pos-int?",-1205815015,null)),cljs.spec.alpha.tuple_impl.cljs$core$IFn$_invoke$arity$2(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol("cljs.core","pos-int?","cljs.core/pos-int?",-2115888030,null),new cljs.core.Symbol("cljs.core","pos-int?","cljs.core/pos-int?",-2115888030,null)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.pos_int_QMARK_,cljs.core.pos_int_QMARK_], null)),new cljs.core.PersistentArrayMap(null, 7, [new cljs.core.Keyword(null,"into","into",-150836029),cljs.core.PersistentArrayMap.EMPTY,new cljs.core.Keyword("cljs.spec.alpha","kind-form","cljs.spec.alpha/kind-form",-1047104697),new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null),new cljs.core.Keyword("cljs.spec.alpha","cpred","cljs.spec.alpha/cpred",-693471218),(function (G__58445){
return cljs.core.map_QMARK_(G__58445);
}),new cljs.core.Keyword(null,"kind","kind",-717265803),cljs.core.map_QMARK_,new cljs.core.Keyword("cljs.spec.alpha","kfn","cljs.spec.alpha/kfn",672643897),(function (i__13227__auto__,v__13228__auto__){
return cljs.core.nth.cljs$core$IFn$_invoke$arity$2(v__13228__auto__,(0));
}),new cljs.core.Keyword("cljs.spec.alpha","conform-all","cljs.spec.alpha/conform-all",45201917),true,new cljs.core.Keyword("cljs.spec.alpha","describe","cljs.spec.alpha/describe",1883026911),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Symbol("cljs.core","pos-int?","cljs.core/pos-int?",-2115888030,null),new cljs.core.Symbol("cljs.core","pos-int?","cljs.core/pos-int?",-2115888030,null))], null),null)], null)),new cljs.core.PersistentArrayMap(null, 7, [new cljs.core.Keyword(null,"into","into",-150836029),cljs.core.PersistentArrayMap.EMPTY,new cljs.core.Keyword("cljs.spec.alpha","kind-form","cljs.spec.alpha/kind-form",-1047104697),new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null),new cljs.core.Keyword("cljs.spec.alpha","cpred","cljs.spec.alpha/cpred",-693471218),(function (G__58439){
return cljs.core.map_QMARK_(G__58439);
}),new cljs.core.Keyword(null,"kind","kind",-717265803),cljs.core.map_QMARK_,new cljs.core.Keyword("cljs.spec.alpha","kfn","cljs.spec.alpha/kfn",672643897),(function (i__13227__auto__,v__13228__auto__){
return cljs.core.nth.cljs$core$IFn$_invoke$arity$2(v__13228__auto__,(0));
}),new cljs.core.Keyword("cljs.spec.alpha","conform-all","cljs.spec.alpha/conform-all",45201917),true,new cljs.core.Keyword("cljs.spec.alpha","describe","cljs.spec.alpha/describe",1883026911),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),new cljs.core.Symbol("cljs.core","pos-int?","cljs.core/pos-int?",-2115888030,null),new cljs.core.Symbol("cljs.core","pos-int?","cljs.core/pos-int?",-2115888030,null)))], null),null));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","keys","cljs.spec.alpha/keys",1109346032,null),new cljs.core.Keyword(null,"opt","opt",-794706369),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","active-remotes","fulcro.history/active-remotes",-1858379711)], null),new cljs.core.Keyword(null,"req","req",-326448303),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","max-size","fulcro.history/max-size",338795187),new cljs.core.Keyword("fulcro.history","history-steps","fulcro.history/history-steps",1960379620)], null)),cljs.spec.alpha.map_spec_impl(cljs.core.PersistentHashMap.fromArrays([new cljs.core.Keyword(null,"req-un","req-un",1074571008),new cljs.core.Keyword(null,"opt-un","opt-un",883442496),new cljs.core.Keyword(null,"gfn","gfn",791517474),new cljs.core.Keyword(null,"pred-exprs","pred-exprs",1792271395),new cljs.core.Keyword(null,"keys-pred","keys-pred",858984739),new cljs.core.Keyword(null,"opt-keys","opt-keys",1262688261),new cljs.core.Keyword(null,"req-specs","req-specs",553962313),new cljs.core.Keyword(null,"req","req",-326448303),new cljs.core.Keyword(null,"req-keys","req-keys",514319221),new cljs.core.Keyword(null,"opt-specs","opt-specs",-384905450),new cljs.core.Keyword(null,"pred-forms","pred-forms",172611832),new cljs.core.Keyword(null,"opt","opt",-794706369)],[null,null,null,new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [(function (G__58447){
return cljs.core.map_QMARK_(G__58447);
}),(function (G__58447){
return cljs.core.contains_QMARK_(G__58447,new cljs.core.Keyword("fulcro.history","max-size","fulcro.history/max-size",338795187));
}),(function (G__58447){
return cljs.core.contains_QMARK_(G__58447,new cljs.core.Keyword("fulcro.history","history-steps","fulcro.history/history-steps",1960379620));
})], null),(function (G__58447){
return ((cljs.core.map_QMARK_(G__58447)) && (cljs.core.contains_QMARK_(G__58447,new cljs.core.Keyword("fulcro.history","max-size","fulcro.history/max-size",338795187))) && (cljs.core.contains_QMARK_(G__58447,new cljs.core.Keyword("fulcro.history","history-steps","fulcro.history/history-steps",1960379620))));
}),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","active-remotes","fulcro.history/active-remotes",-1858379711)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","max-size","fulcro.history/max-size",338795187),new cljs.core.Keyword("fulcro.history","history-steps","fulcro.history/history-steps",1960379620)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","max-size","fulcro.history/max-size",338795187),new cljs.core.Keyword("fulcro.history","history-steps","fulcro.history/history-steps",1960379620)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","max-size","fulcro.history/max-size",338795187),new cljs.core.Keyword("fulcro.history","history-steps","fulcro.history/history-steps",1960379620)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","active-remotes","fulcro.history/active-remotes",-1858379711)], null),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.list(new cljs.core.Symbol("cljs.core","fn","cljs.core/fn",-1065745098,null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"%","%",-950237169,null)], null),cljs.core.list(new cljs.core.Symbol("cljs.core","map?","cljs.core/map?",-1390345523,null),new cljs.core.Symbol(null,"%","%",-950237169,null))),cljs.core.list(new cljs.core.Symbol("cljs.core","fn","cljs.core/fn",-1065745098,null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"%","%",-950237169,null)], null),cljs.core.list(new cljs.core.Symbol("cljs.core","contains?","cljs.core/contains?",-976526835,null),new cljs.core.Symbol(null,"%","%",-950237169,null),new cljs.core.Keyword("fulcro.history","max-size","fulcro.history/max-size",338795187))),cljs.core.list(new cljs.core.Symbol("cljs.core","fn","cljs.core/fn",-1065745098,null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"%","%",-950237169,null)], null),cljs.core.list(new cljs.core.Symbol("cljs.core","contains?","cljs.core/contains?",-976526835,null),new cljs.core.Symbol(null,"%","%",-950237169,null),new cljs.core.Keyword("fulcro.history","history-steps","fulcro.history/history-steps",1960379620)))], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","active-remotes","fulcro.history/active-remotes",-1858379711)], null)])));
cljs.spec.alpha.def_impl(new cljs.core.Keyword("fulcro.history","history-atom","fulcro.history/history-atom",-1250797564),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","and","cljs.spec.alpha/and",-2060279705,null),cljs.core.list(new cljs.core.Symbol(null,"fn*","fn*",-752876845,null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"p1__58513#","p1__58513#",-659953075,null)], null),cljs.core.list(new cljs.core.Symbol("fulcro.util","atom?","fulcro.util/atom?",-1021006071,null),new cljs.core.Symbol(null,"p1__58513#","p1__58513#",-659953075,null))),cljs.core.list(new cljs.core.Symbol(null,"fn*","fn*",-752876845,null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"p1__58514#","p1__58514#",-603542068,null)], null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","valid?","cljs.spec.alpha/valid?",-142132235,null),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),cljs.core.list(new cljs.core.Symbol("cljs.core","deref","cljs.core/deref",1901963335,null),new cljs.core.Symbol(null,"p1__58514#","p1__58514#",-603542068,null))))),cljs.spec.alpha.and_spec_impl(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.list(new cljs.core.Symbol("cljs.core","fn","cljs.core/fn",-1065745098,null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"%","%",-950237169,null)], null),cljs.core.list(new cljs.core.Symbol("fulcro.util","atom?","fulcro.util/atom?",-1021006071,null),new cljs.core.Symbol(null,"%","%",-950237169,null))),cljs.core.list(new cljs.core.Symbol("cljs.core","fn","cljs.core/fn",-1065745098,null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"%","%",-950237169,null)], null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","valid?","cljs.spec.alpha/valid?",-142132235,null),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),cljs.core.list(new cljs.core.Symbol("cljs.core","deref","cljs.core/deref",1901963335,null),new cljs.core.Symbol(null,"%","%",-950237169,null))))], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [(function (p1__58513_SHARP_){
return fulcro.util.atom_QMARK_(p1__58513_SHARP_);
}),(function (p1__58514_SHARP_){
return cljs.spec.alpha.valid_QMARK_.cljs$core$IFn$_invoke$arity$2(new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),cljs.core.deref(p1__58514_SHARP_));
})], null),null));
fulcro.history.max_tx_time = (9200000000000000000);
fulcro.history.decrement_or_remove = (function fulcro$history$decrement_or_remove(m,k){
if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2((1),cljs.core.get.cljs$core$IFn$_invoke$arity$3(m,k,(1)))){
return cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(m,k);
} else {
return cljs.core.update.cljs$core$IFn$_invoke$arity$3(m,k,cljs.core.dec);
}
});
fulcro.history.add_or_increment = (function fulcro$history$add_or_increment(m,k){
return cljs.core.update.cljs$core$IFn$_invoke$arity$3(m,k,cljs.core.fnil.cljs$core$IFn$_invoke$arity$2(cljs.core.inc,(0)));
});
/**
 * Record that remote activity started for the given remote at the given tx-time. Returns a new history.
 */
fulcro.history.remote_activity_started = (function fulcro$history$remote_activity_started(history,remote,tx_time){
if(cljs.core.truth_((function (){var and__4120__auto__ = remote;
if(cljs.core.truth_(and__4120__auto__)){
return tx_time;
} else {
return and__4120__auto__;
}
})())){
return cljs.core.update_in.cljs$core$IFn$_invoke$arity$4(history,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","active-remotes","fulcro.history/active-remotes",-1858379711),remote], null),fulcro.history.add_or_increment,tx_time);
} else {
return history;
}
});
cljs.spec.alpha.def_impl(new cljs.core.Symbol("fulcro.history","remote-activity-started","fulcro.history/remote-activity-started",2010207540,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","fspec","cljs.spec.alpha/fspec",-1289128341,null),new cljs.core.Keyword(null,"args","args",1315556576),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword(null,"remote","remote",-1593576576),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"remote","remote",-1593576576),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null)),new cljs.core.Keyword(null,"time","time",1385887882),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456)),new cljs.core.Keyword(null,"ret","ret",-468222814),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),cljs.spec.alpha.fspec_impl(cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword(null,"remote","remote",-1593576576),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"remote","remote",-1593576576),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null)),new cljs.core.Keyword(null,"time","time",1385887882),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456)),cljs.spec.alpha.cat_impl(new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword(null,"remote","remote",-1593576576),new cljs.core.Keyword(null,"time","time",1385887882)], null),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),cljs.spec.alpha.or_spec_impl(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Keyword(null,"remote","remote",-1593576576)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.nil_QMARK_,cljs.core.keyword_QMARK_], null),null),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456)], null),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"remote","remote",-1593576576),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null)),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456)], null)),null,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword(null,"remote","remote",-1593576576),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"remote","remote",-1593576576),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null)),new cljs.core.Keyword(null,"time","time",1385887882),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456)),cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),null,null),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),null,null,null));
/**
 * Record that remote activity finished for the given remote at the given tx-time. Returns a new history.
 */
fulcro.history.remote_activity_finished = (function fulcro$history$remote_activity_finished(history,remote,tx_time){
if(cljs.core.truth_((function (){var and__4120__auto__ = remote;
if(cljs.core.truth_(and__4120__auto__)){
return tx_time;
} else {
return and__4120__auto__;
}
})())){
return cljs.core.update_in.cljs$core$IFn$_invoke$arity$4(history,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","active-remotes","fulcro.history/active-remotes",-1858379711),remote], null),fulcro.history.decrement_or_remove,tx_time);
} else {
return history;
}
});
cljs.spec.alpha.def_impl(new cljs.core.Symbol("fulcro.history","remote-activity-finished","fulcro.history/remote-activity-finished",-1247982384,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","fspec","cljs.spec.alpha/fspec",-1289128341,null),new cljs.core.Keyword(null,"args","args",1315556576),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword(null,"remote","remote",-1593576576),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"remote","remote",-1593576576),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null)),new cljs.core.Keyword(null,"time","time",1385887882),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456)),new cljs.core.Keyword(null,"ret","ret",-468222814),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),cljs.spec.alpha.fspec_impl(cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword(null,"remote","remote",-1593576576),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"remote","remote",-1593576576),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null)),new cljs.core.Keyword(null,"time","time",1385887882),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456)),cljs.spec.alpha.cat_impl(new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword(null,"remote","remote",-1593576576),new cljs.core.Keyword(null,"time","time",1385887882)], null),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),cljs.spec.alpha.or_spec_impl(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Keyword(null,"remote","remote",-1593576576)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.nil_QMARK_,cljs.core.keyword_QMARK_], null),null),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456)], null),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"remote","remote",-1593576576),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null)),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456)], null)),null,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword(null,"remote","remote",-1593576576),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"remote","remote",-1593576576),new cljs.core.Symbol("cljs.core","keyword?","cljs.core/keyword?",713156450,null)),new cljs.core.Keyword(null,"time","time",1385887882),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456)),cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),null,null),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),null,null,null));
/**
 * Returns the tx time for the oldest in-flight send that is active. Returns Long/MAX_VALUE if none are active.
 */
fulcro.history.oldest_active_network_request = (function fulcro$history$oldest_active_network_request(p__58566){
var map__58569 = p__58566;
var map__58569__$1 = (((((!((map__58569 == null))))?(((((map__58569.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__58569.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.hash_map,map__58569):map__58569);
var history = map__58569__$1;
var active_remotes = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58569__$1,new cljs.core.Keyword("fulcro.history","active-remotes","fulcro.history/active-remotes",-1858379711));
return cljs.core.reduce.cljs$core$IFn$_invoke$arity$3(cljs.core.min,fulcro.history.max_tx_time,cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.concat,(function (){var G__58572 = active_remotes;
var G__58572__$1 = (((G__58572 == null))?null:cljs.core.vals(G__58572));
if((G__58572__$1 == null)){
return null;
} else {
return cljs.core.map.cljs$core$IFn$_invoke$arity$2(cljs.core.keys,G__58572__$1);
}
})()));
});
cljs.spec.alpha.def_impl(new cljs.core.Symbol("fulcro.history","oldest-active-network-request","fulcro.history/oldest-active-network-request",-1353768021,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","fspec","cljs.spec.alpha/fspec",-1289128341,null),new cljs.core.Keyword(null,"args","args",1315556576),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),new cljs.core.Keyword(null,"ret","ret",-468222814),new cljs.core.Symbol("cljs.core","int?","cljs.core/int?",50730120,null)),cljs.spec.alpha.fspec_impl(cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),cljs.spec.alpha.cat_impl(new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"hist","hist",-1294086168)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)], null)),null,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(new cljs.core.Symbol("cljs.core","int?","cljs.core/int?",50730120,null),cljs.core.int_QMARK_,null,null),new cljs.core.Symbol("cljs.core","int?","cljs.core/int?",50730120,null),null,null,null));
cljs.spec.alpha.def_impl(new cljs.core.Symbol("fulcro.history","oldest-active-network-request","fulcro.history/oldest-active-network-request",-1353768021,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","fspec","cljs.spec.alpha/fspec",-1289128341,null),new cljs.core.Keyword(null,"args","args",1315556576),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),new cljs.core.Keyword(null,"ref","ref",1289896967),new cljs.core.Symbol("cljs.core","int?","cljs.core/int?",50730120,null)),cljs.spec.alpha.fspec_impl(cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),cljs.spec.alpha.cat_impl(new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"hist","hist",-1294086168)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)], null)),null,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(new cljs.core.Symbol("cljs.core","any?","cljs.core/any?",-2068111842,null),cljs.core.any_QMARK_,null,null),new cljs.core.Symbol("cljs.core","any?","cljs.core/any?",-2068111842,null),null,null,null));
/**
 * Returns a new history that has been reduced in size to target levels.
 */
fulcro.history.gc_history = (function fulcro$history$gc_history(p__58593){
var map__58597 = p__58593;
var map__58597__$1 = (((((!((map__58597 == null))))?(((((map__58597.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__58597.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.hash_map,map__58597):map__58597);
var history = map__58597__$1;
var max_size = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58597__$1,new cljs.core.Keyword("fulcro.history","max-size","fulcro.history/max-size",338795187));
var history_steps = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58597__$1,new cljs.core.Keyword("fulcro.history","history-steps","fulcro.history/history-steps",1960379620));
if(((cljs.core.pos_int_QMARK_(max_size)) && ((cljs.core.count(history_steps) > max_size)))){
var oldest_required_history_step = fulcro.history.oldest_active_network_request(history);
var current_size = cljs.core.count(history_steps);
var overage = (current_size - max_size);
var ordered_step_keys = cljs.core.sort.cljs$core$IFn$_invoke$arity$1(cljs.core.keys(history_steps));
var proposed_keeper_keys = cljs.core.drop.cljs$core$IFn$_invoke$arity$2(overage,ordered_step_keys);
var real_keeper_keys = (((cljs.core.first(proposed_keeper_keys) > oldest_required_history_step))?(function (){
try{fulcro.logging._log.cljs$core$IFn$_invoke$arity$variadic(new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword(null,"file","file",-1269645878),"fulcro.history",new cljs.core.Keyword(null,"line","line",212345235),82], null),new cljs.core.Keyword(null,"warn","warn",-436710552),cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2(["History has grown beyond max size due to network congestion."], 0));
}catch (e58601){if((e58601 instanceof Error)){
var e__55143__auto___58935 = e58601;
fulcro.logging._log.cljs$core$IFn$_invoke$arity$variadic(new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword(null,"file","file",-1269645878),"fulcro.history",new cljs.core.Keyword(null,"line","line",212345235),82], null),new cljs.core.Keyword(null,"warn","warn",-436710552),cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2(["Log statement failed (arguments did not evaluate).",e__55143__auto___58935], 0));
} else {
throw e58601;

}
}
return cljs.core.drop_while.cljs$core$IFn$_invoke$arity$2(((function (oldest_required_history_step,current_size,overage,ordered_step_keys,proposed_keeper_keys,map__58597,map__58597__$1,history,max_size,history_steps){
return (function (t){
return (t < oldest_required_history_step);
});})(oldest_required_history_step,current_size,overage,ordered_step_keys,proposed_keeper_keys,map__58597,map__58597__$1,history,max_size,history_steps))
,ordered_step_keys);
})()
:proposed_keeper_keys);
return cljs.core.update.cljs$core$IFn$_invoke$arity$4(history,new cljs.core.Keyword("fulcro.history","history-steps","fulcro.history/history-steps",1960379620),cljs.core.select_keys,real_keeper_keys);
} else {
return history;
}
});
cljs.spec.alpha.def_impl(new cljs.core.Symbol("fulcro.history","gc-history","fulcro.history/gc-history",1853772558,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","fspec","cljs.spec.alpha/fspec",-1289128341,null),new cljs.core.Keyword(null,"args","args",1315556576),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),new cljs.core.Keyword(null,"ref","ref",1289896967),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),cljs.spec.alpha.fspec_impl(cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),cljs.spec.alpha.cat_impl(new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"hist","hist",-1294086168)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)], null)),null,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(new cljs.core.Symbol("cljs.core","any?","cljs.core/any?",-2068111842,null),cljs.core.any_QMARK_,null,null),new cljs.core.Symbol("cljs.core","any?","cljs.core/any?",-2068111842,null),null,null,null));
fulcro.history.compressible_tx = (function fulcro$history$compressible_tx(tx){
return cljs.core.vary_meta.cljs$core$IFn$_invoke$arity$4(tx,cljs.core.assoc,new cljs.core.Keyword("fulcro.history","compressible?","fulcro.history/compressible?",1366178661),true);
});
cljs.spec.alpha.def_impl(new cljs.core.Symbol("fulcro.history","compressible-tx","fulcro.history/compressible-tx",-1033554138,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","fspec","cljs.spec.alpha/fspec",-1289128341,null),new cljs.core.Keyword(null,"args","args",1315556576),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"tx","tx",466630418),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"tx","tx",466630418),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null))),new cljs.core.Keyword(null,"ret","ret",-468222814),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"tx","tx",466630418),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null))),cljs.spec.alpha.fspec_impl(cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"tx","tx",466630418),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"tx","tx",466630418),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null))),cljs.spec.alpha.cat_impl(new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"tx","tx",466630418)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.spec.alpha.or_spec_impl(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Keyword(null,"tx","tx",466630418)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.nil_QMARK_,cljs.core.vector_QMARK_], null),null)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"tx","tx",466630418),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null))], null)),null,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"tx","tx",466630418),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"tx","tx",466630418),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null))),cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"tx","tx",466630418),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null)),cljs.spec.alpha.or_spec_impl(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Keyword(null,"tx","tx",466630418)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.nil_QMARK_,cljs.core.vector_QMARK_], null),null),null,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"tx","tx",466630418),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null)),null,null,null));
/**
 * Returns true if the given transaction is marked as compressible.
 */
fulcro.history.compressible_tx_QMARK_ = (function fulcro$history$compressible_tx_QMARK_(tx){
return cljs.core.boolean$((function (){var G__58632 = tx;
var G__58632__$1 = (((G__58632 == null))?null:cljs.core.meta(G__58632));
if((G__58632__$1 == null)){
return null;
} else {
return new cljs.core.Keyword("fulcro.history","compressible?","fulcro.history/compressible?",1366178661).cljs$core$IFn$_invoke$arity$1(G__58632__$1);
}
})());
});
cljs.spec.alpha.def_impl(new cljs.core.Symbol("fulcro.history","compressible-tx?","fulcro.history/compressible-tx?",836197026,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","fspec","cljs.spec.alpha/fspec",-1289128341,null),new cljs.core.Keyword(null,"args","args",1315556576),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"tx","tx",466630418),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"tx","tx",466630418),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null))),new cljs.core.Keyword(null,"ret","ret",-468222814),new cljs.core.Symbol("cljs.core","boolean?","cljs.core/boolean?",1400713761,null)),cljs.spec.alpha.fspec_impl(cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"tx","tx",466630418),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"tx","tx",466630418),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null))),cljs.spec.alpha.cat_impl(new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"tx","tx",466630418)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.spec.alpha.or_spec_impl(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Keyword(null,"tx","tx",466630418)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.nil_QMARK_,cljs.core.vector_QMARK_], null),null)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"tx","tx",466630418),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null))], null)),null,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"tx","tx",466630418),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"missing","missing",362507769),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"tx","tx",466630418),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null))),cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(new cljs.core.Symbol("cljs.core","boolean?","cljs.core/boolean?",1400713761,null),cljs.core.boolean_QMARK_,null,null),new cljs.core.Symbol("cljs.core","boolean?","cljs.core/boolean?",1400713761,null),null,null,null));
/**
 * Returns the most recent transition edge time recorded in the given history.
 */
fulcro.history.last_tx_time = (function fulcro$history$last_tx_time(p__58655){
var map__58656 = p__58655;
var map__58656__$1 = (((((!((map__58656 == null))))?(((((map__58656.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__58656.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.hash_map,map__58656):map__58656);
var history = map__58656__$1;
var history_steps = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58656__$1,new cljs.core.Keyword("fulcro.history","history-steps","fulcro.history/history-steps",1960379620));
return cljs.core.reduce.cljs$core$IFn$_invoke$arity$3(cljs.core.max,(0),cljs.core.keys(history_steps));
});
cljs.spec.alpha.def_impl(new cljs.core.Symbol("fulcro.history","last-tx-time","fulcro.history/last-tx-time",-814635825,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","fspec","cljs.spec.alpha/fspec",-1289128341,null),new cljs.core.Keyword(null,"args","args",1315556576),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),new cljs.core.Keyword(null,"ret","ret",-468222814),new cljs.core.Symbol("cljs.core","int?","cljs.core/int?",50730120,null)),cljs.spec.alpha.fspec_impl(cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),cljs.spec.alpha.cat_impl(new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"hist","hist",-1294086168)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)], null)),null,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(new cljs.core.Symbol("cljs.core","int?","cljs.core/int?",50730120,null),cljs.core.int_QMARK_,null,null),new cljs.core.Symbol("cljs.core","int?","cljs.core/int?",50730120,null),null,null,null));
/**
 * Record a history step in the reconciler. 
 */
fulcro.history.record_history_step = (function fulcro$history$record_history_step(p__58672,tx_time,p__58673){
var map__58674 = p__58672;
var map__58674__$1 = (((((!((map__58674 == null))))?(((((map__58674.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__58674.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.hash_map,map__58674):map__58674);
var history = map__58674__$1;
var history_steps = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58674__$1,new cljs.core.Keyword("fulcro.history","history-steps","fulcro.history/history-steps",1960379620));
var active_remotes = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58674__$1,new cljs.core.Keyword("fulcro.history","active-remotes","fulcro.history/active-remotes",-1858379711));
var map__58675 = p__58673;
var map__58675__$1 = (((((!((map__58675 == null))))?(((((map__58675.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__58675.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.hash_map,map__58675):map__58675);
var step = map__58675__$1;
var tx = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58675__$1,new cljs.core.Keyword("fulcro.history","tx","fulcro.history/tx",1485693993));
var last_time = fulcro.history.last_tx_time(history);
var gc_QMARK_ = cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2((0),cljs.core.mod(tx_time,(10)));
var last_tx = cljs.core.get_in.cljs$core$IFn$_invoke$arity$3(history_steps,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [last_time,new cljs.core.Keyword("fulcro.history","tx","fulcro.history/tx",1485693993)], null),cljs.core.PersistentVector.EMPTY);
var all_active_steps = cljs.core.reduce.cljs$core$IFn$_invoke$arity$3(clojure.set.union,cljs.core.PersistentHashSet.EMPTY,(function (){var G__58691 = active_remotes;
var G__58691__$1 = (((G__58691 == null))?null:cljs.core.vals(G__58691));
if((G__58691__$1 == null)){
return null;
} else {
return cljs.core.map.cljs$core$IFn$_invoke$arity$2(cljs.core.comp.cljs$core$IFn$_invoke$arity$2(cljs.core.set,cljs.core.keys),G__58691__$1);
}
})());
var compressible_QMARK_ = ((fulcro.history.compressible_tx_QMARK_(tx)) && (fulcro.history.compressible_tx_QMARK_(last_tx)) && ((!(cljs.core.contains_QMARK_(all_active_steps,last_time)))));
var new_history = (function (){var G__58699 = cljs.core.assoc_in(history,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history-steps","fulcro.history/history-steps",1960379620),tx_time], null),step);
if(compressible_QMARK_){
return cljs.core.update.cljs$core$IFn$_invoke$arity$4(G__58699,new cljs.core.Keyword("fulcro.history","history-steps","fulcro.history/history-steps",1960379620),cljs.core.dissoc,last_time);
} else {
return G__58699;
}
})();
if(gc_QMARK_){
return fulcro.history.gc_history(new_history);
} else {
return new_history;
}
});
cljs.spec.alpha.def_impl(new cljs.core.Symbol("fulcro.history","record-history-step","fulcro.history/record-history-step",929203105,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","fspec","cljs.spec.alpha/fspec",-1289128341,null),new cljs.core.Keyword(null,"args","args",1315556576),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword(null,"time","time",1385887882),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456),new cljs.core.Keyword(null,"step","step",1288888124),new cljs.core.Keyword("fulcro.history","history-step","fulcro.history/history-step",-880117884)),new cljs.core.Keyword(null,"ret","ret",-468222814),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),cljs.spec.alpha.fspec_impl(cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword(null,"time","time",1385887882),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456),new cljs.core.Keyword(null,"step","step",1288888124),new cljs.core.Keyword("fulcro.history","history-step","fulcro.history/history-step",-880117884)),cljs.spec.alpha.cat_impl(new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword(null,"time","time",1385887882),new cljs.core.Keyword(null,"step","step",1288888124)], null),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456),new cljs.core.Keyword("fulcro.history","history-step","fulcro.history/history-step",-880117884)], null),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456),new cljs.core.Keyword("fulcro.history","history-step","fulcro.history/history-step",-880117884)], null)),null,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword(null,"time","time",1385887882),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456),new cljs.core.Keyword(null,"step","step",1288888124),new cljs.core.Keyword("fulcro.history","history-step","fulcro.history/history-step",-880117884)),cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),null,null),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),null,null,null));
fulcro.history.new_history = (function fulcro$history$new_history(size){
return new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword("fulcro.history","max-size","fulcro.history/max-size",338795187),size,new cljs.core.Keyword("fulcro.history","history-steps","fulcro.history/history-steps",1960379620),cljs.core.PersistentArrayMap.EMPTY,new cljs.core.Keyword("fulcro.history","active-remotes","fulcro.history/active-remotes",-1858379711),cljs.core.PersistentArrayMap.EMPTY], null);
});
cljs.spec.alpha.def_impl(new cljs.core.Symbol("fulcro.history","new-history","fulcro.history/new-history",-1295571323,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","fspec","cljs.spec.alpha/fspec",-1289128341,null),new cljs.core.Keyword(null,"args","args",1315556576),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"size","size",1098693007),new cljs.core.Symbol("cljs.core","pos-int?","cljs.core/pos-int?",-2115888030,null)),new cljs.core.Keyword(null,"ret","ret",-468222814),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),cljs.spec.alpha.fspec_impl(cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"size","size",1098693007),new cljs.core.Symbol("cljs.core","pos-int?","cljs.core/pos-int?",-2115888030,null)),cljs.spec.alpha.cat_impl(new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"size","size",1098693007)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.pos_int_QMARK_], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol("cljs.core","pos-int?","cljs.core/pos-int?",-2115888030,null)], null)),null,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"size","size",1098693007),new cljs.core.Symbol("cljs.core","pos-int?","cljs.core/pos-int?",-2115888030,null)),cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),null,null),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),null,null,null));
/**
 * Returns the current valid sequence of step times in the given history as a sorted vector.
 */
fulcro.history.ordered_steps = (function fulcro$history$ordered_steps(history){
var G__58725 = history;
var G__58725__$1 = (((G__58725 == null))?null:new cljs.core.Keyword("fulcro.history","history-steps","fulcro.history/history-steps",1960379620).cljs$core$IFn$_invoke$arity$1(G__58725));
var G__58725__$2 = (((G__58725__$1 == null))?null:cljs.core.keys(G__58725__$1));
var G__58725__$3 = (((G__58725__$2 == null))?null:cljs.core.sort.cljs$core$IFn$_invoke$arity$1(G__58725__$2));
if((G__58725__$3 == null)){
return null;
} else {
return cljs.core.vec(G__58725__$3);
}
});
cljs.spec.alpha.def_impl(new cljs.core.Symbol("fulcro.history","ordered-steps","fulcro.history/ordered-steps",341796067,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","fspec","cljs.spec.alpha/fspec",-1289128341,null),new cljs.core.Keyword(null,"args","args",1315556576),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),new cljs.core.Keyword(null,"ret","ret",-468222814),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"v","v",21465059),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","every","cljs.spec.alpha/every",123912744,null),new cljs.core.Symbol("cljs.core","int?","cljs.core/int?",50730120,null),new cljs.core.Keyword(null,"kind","kind",-717265803),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null)),new cljs.core.Keyword(null,"nothing","nothing",-1022703296),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null))),cljs.spec.alpha.fspec_impl(cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),cljs.spec.alpha.cat_impl(new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"hist","hist",-1294086168)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)], null)),null,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549)),cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"v","v",21465059),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","every","cljs.spec.alpha/every",123912744,null),new cljs.core.Symbol("cljs.core","int?","cljs.core/int?",50730120,null),new cljs.core.Keyword(null,"kind","kind",-717265803),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null)),new cljs.core.Keyword(null,"nothing","nothing",-1022703296),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null)),cljs.spec.alpha.or_spec_impl(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"v","v",21465059),new cljs.core.Keyword(null,"nothing","nothing",-1022703296)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","every","cljs.spec.alpha/every",123912744,null),new cljs.core.Symbol("cljs.core","int?","cljs.core/int?",50730120,null),new cljs.core.Keyword(null,"kind","kind",-717265803),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null)),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.spec.alpha.every_impl.cljs$core$IFn$_invoke$arity$4(new cljs.core.Symbol(null,"int?","int?",1799729645,null),cljs.core.int_QMARK_,new cljs.core.PersistentArrayMap(null, 4, [new cljs.core.Keyword("cljs.spec.alpha","kind-form","cljs.spec.alpha/kind-form",-1047104697),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null),new cljs.core.Keyword("cljs.spec.alpha","cpred","cljs.spec.alpha/cpred",-693471218),(function (G__58747){
return cljs.core.vector_QMARK_(G__58747);
}),new cljs.core.Keyword(null,"kind","kind",-717265803),cljs.core.vector_QMARK_,new cljs.core.Keyword("cljs.spec.alpha","describe","cljs.spec.alpha/describe",1883026911),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","every","cljs.spec.alpha/every",123912744,null),new cljs.core.Symbol("cljs.core","int?","cljs.core/int?",50730120,null),new cljs.core.Keyword(null,"kind","kind",-717265803),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null))], null),null),cljs.core.nil_QMARK_], null),null),null,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"v","v",21465059),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","every","cljs.spec.alpha/every",123912744,null),new cljs.core.Symbol("cljs.core","int?","cljs.core/int?",50730120,null),new cljs.core.Keyword(null,"kind","kind",-717265803),new cljs.core.Symbol("cljs.core","vector?","cljs.core/vector?",-1550392028,null)),new cljs.core.Keyword(null,"nothing","nothing",-1022703296),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null)),null,null,null));
/**
 * Returns a step from the given history that has the given tx-time. If tx-time specifies a spot where there is a gap in the history
 *   (there are steps before and after), then it will return the earlier step, unless the latter was compressible, in which case
 *   it will return the step into which the desired spot was compressed. 
 */
fulcro.history.get_step = (function fulcro$history$get_step(p__58755,tx_time){
var map__58756 = p__58755;
var map__58756__$1 = (((((!((map__58756 == null))))?(((((map__58756.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__58756.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.hash_map,map__58756):map__58756);
var history = map__58756__$1;
var history_steps = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58756__$1,new cljs.core.Keyword("fulcro.history","history-steps","fulcro.history/history-steps",1960379620));
var temp__5718__auto__ = cljs.core.get.cljs$core$IFn$_invoke$arity$2(history_steps,tx_time);
if(cljs.core.truth_(temp__5718__auto__)){
var exact_step = temp__5718__auto__;
return exact_step;
} else {
var timeline = fulcro.history.ordered_steps(history);
var vec__58764 = cljs.core.split_with(((function (timeline,temp__5718__auto__,map__58756,map__58756__$1,history,history_steps){
return (function (p1__58750_SHARP_){
return (tx_time > p1__58750_SHARP_);
});})(timeline,temp__5718__auto__,map__58756,map__58756__$1,history,history_steps))
,timeline);
var before = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__58764,(0),null);
var after = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__58764,(1),null);
var step_before = cljs.core.get.cljs$core$IFn$_invoke$arity$2(history_steps,cljs.core.last(before));
var step_after = cljs.core.get.cljs$core$IFn$_invoke$arity$2(history_steps,cljs.core.first(after));
if(cljs.core.truth_((function (){var and__4120__auto__ = step_before;
if(cljs.core.truth_(and__4120__auto__)){
var and__4120__auto____$1 = step_after;
if(cljs.core.truth_(and__4120__auto____$1)){
return fulcro.history.compressible_tx_QMARK_(new cljs.core.Keyword("fulcro.history","tx","fulcro.history/tx",1485693993).cljs$core$IFn$_invoke$arity$1(step_after));
} else {
return and__4120__auto____$1;
}
} else {
return and__4120__auto__;
}
})())){
return step_after;
} else {
if(cljs.core.truth_((function (){var and__4120__auto__ = step_before;
if(cljs.core.truth_(and__4120__auto__)){
return step_after;
} else {
return and__4120__auto__;
}
})())){
return step_before;
} else {
return null;

}
}
}
});
cljs.spec.alpha.def_impl(new cljs.core.Symbol("fulcro.history","get-step","fulcro.history/get-step",489831412,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","fspec","cljs.spec.alpha/fspec",-1289128341,null),new cljs.core.Keyword(null,"args","args",1315556576),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword(null,"time","time",1385887882),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456)),new cljs.core.Keyword(null,"ret","ret",-468222814),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"nothing","nothing",-1022703296),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"step","step",1288888124),new cljs.core.Keyword("fulcro.history","history-step","fulcro.history/history-step",-880117884))),cljs.spec.alpha.fspec_impl(cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword(null,"time","time",1385887882),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456)),cljs.spec.alpha.cat_impl(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword(null,"time","time",1385887882)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456)], null)),null,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","cat","cljs.spec.alpha/cat",-1471398329,null),new cljs.core.Keyword(null,"hist","hist",-1294086168),new cljs.core.Keyword("fulcro.history","history","fulcro.history/history",-913869549),new cljs.core.Keyword(null,"time","time",1385887882),new cljs.core.Keyword("fulcro.history","tx-time","fulcro.history/tx-time",816348456)),cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4(cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"nothing","nothing",-1022703296),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"step","step",1288888124),new cljs.core.Keyword("fulcro.history","history-step","fulcro.history/history-step",-880117884)),cljs.spec.alpha.or_spec_impl(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"nothing","nothing",-1022703296),new cljs.core.Keyword(null,"step","step",1288888124)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword("fulcro.history","history-step","fulcro.history/history-step",-880117884)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.nil_QMARK_,new cljs.core.Keyword("fulcro.history","history-step","fulcro.history/history-step",-880117884)], null),null),null,null),cljs.core.list(new cljs.core.Symbol("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),new cljs.core.Keyword(null,"nothing","nothing",-1022703296),new cljs.core.Symbol("cljs.core","nil?","cljs.core/nil?",945071861,null),new cljs.core.Keyword(null,"step","step",1288888124),new cljs.core.Keyword("fulcro.history","history-step","fulcro.history/history-step",-880117884)),null,null,null));
/**
 * Returns a navigator of history. Use focus-next, focus-previous, and current-step.
 */
fulcro.history.history_navigator = (function fulcro$history$history_navigator(history){
var steps = fulcro.history.ordered_steps(history);
return new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword(null,"legal-steps","legal-steps",-577830084),steps,new cljs.core.Keyword(null,"history","history",-247395220),history,new cljs.core.Keyword(null,"index","index",-1531685915),(cljs.core.count(steps) - (1))], null);
});
/**
 * Gives back navigation position as a pair [current-index count-of-steps]
 */
fulcro.history.nav_position = (function fulcro$history$nav_position(history_nav){
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"index","index",-1531685915).cljs$core$IFn$_invoke$arity$1(history_nav),cljs.core.count(new cljs.core.Keyword(null,"legal-steps","legal-steps",-577830084).cljs$core$IFn$_invoke$arity$1(history_nav))], null);
});
/**
 * Returns a new history navigation with the focus on the next step (or the last if already there). See history-navigator
 */
fulcro.history.focus_next = (function fulcro$history$focus_next(history_nav){
var map__58793 = history_nav;
var map__58793__$1 = (((((!((map__58793 == null))))?(((((map__58793.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__58793.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.hash_map,map__58793):map__58793);
var index = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58793__$1,new cljs.core.Keyword(null,"index","index",-1531685915));
var history = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58793__$1,new cljs.core.Keyword(null,"history","history",-247395220));
var legal_steps = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58793__$1,new cljs.core.Keyword(null,"legal-steps","legal-steps",-577830084));
var last_legal_idx = (cljs.core.count(legal_steps) - (1));
return cljs.core.update.cljs$core$IFn$_invoke$arity$3(history_nav,new cljs.core.Keyword(null,"index","index",-1531685915),((function (map__58793,map__58793__$1,index,history,legal_steps,last_legal_idx){
return (function (i){
if((i < last_legal_idx)){
return (i + (1));
} else {
return i;
}
});})(map__58793,map__58793__$1,index,history,legal_steps,last_legal_idx))
);
});
/**
 * Returns a new history navigation with the focus on the prior step (or the first if already there). See history-navigator
 */
fulcro.history.focus_previous = (function fulcro$history$focus_previous(history_nav){
var map__58804 = history_nav;
var map__58804__$1 = (((((!((map__58804 == null))))?(((((map__58804.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__58804.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.hash_map,map__58804):map__58804);
var index = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58804__$1,new cljs.core.Keyword(null,"index","index",-1531685915));
var history = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58804__$1,new cljs.core.Keyword(null,"history","history",-247395220));
var legal_steps = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58804__$1,new cljs.core.Keyword(null,"legal-steps","legal-steps",-577830084));
return cljs.core.update.cljs$core$IFn$_invoke$arity$3(history_nav,new cljs.core.Keyword(null,"index","index",-1531685915),((function (map__58804,map__58804__$1,index,history,legal_steps){
return (function (i){
if((i === (0))){
return (0);
} else {
return (i - (1));
}
});})(map__58804,map__58804__$1,index,history,legal_steps))
);
});
/**
 * Returns a new history navigation with the focus on the prior step (or the first if already there). See history-navigator
 */
fulcro.history.focus_start = (function fulcro$history$focus_start(history_nav){
var map__58812 = history_nav;
var map__58812__$1 = (((((!((map__58812 == null))))?(((((map__58812.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__58812.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.hash_map,map__58812):map__58812);
var index = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58812__$1,new cljs.core.Keyword(null,"index","index",-1531685915));
var history = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58812__$1,new cljs.core.Keyword(null,"history","history",-247395220));
var legal_steps = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58812__$1,new cljs.core.Keyword(null,"legal-steps","legal-steps",-577830084));
return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(history_nav,new cljs.core.Keyword(null,"index","index",-1531685915),(0));
});
/**
 * Returns a new history navigation with the focus on the prior step (or the first if already there). See history-navigator
 */
fulcro.history.focus_end = (function fulcro$history$focus_end(history_nav){
var map__58820 = history_nav;
var map__58820__$1 = (((((!((map__58820 == null))))?(((((map__58820.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__58820.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.hash_map,map__58820):map__58820);
var index = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58820__$1,new cljs.core.Keyword(null,"index","index",-1531685915));
var history = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58820__$1,new cljs.core.Keyword(null,"history","history",-247395220));
var legal_steps = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58820__$1,new cljs.core.Keyword(null,"legal-steps","legal-steps",-577830084));
return cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(history_nav,new cljs.core.Keyword(null,"index","index",-1531685915),(cljs.core.count(legal_steps) - (1)));
});
/**
 * Get the current history step from the history-nav. See history-navigator.
 */
fulcro.history.current_step = (function fulcro$history$current_step(history_nav){
var map__58831 = history_nav;
var map__58831__$1 = (((((!((map__58831 == null))))?(((((map__58831.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__58831.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.hash_map,map__58831):map__58831);
var index = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58831__$1,new cljs.core.Keyword(null,"index","index",-1531685915));
var history = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58831__$1,new cljs.core.Keyword(null,"history","history",-247395220));
var legal_steps = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__58831__$1,new cljs.core.Keyword(null,"legal-steps","legal-steps",-577830084));
var history_step_tx_time = cljs.core.get.cljs$core$IFn$_invoke$arity$2(legal_steps,index);
var history_step = fulcro.history.get_step(history,history_step_tx_time);
return history_step;
});

//# sourceMappingURL=fulcro.history.js.map
