{"version":3,"sources":["com/wsscode/pathom/book/connect/mutation_join_globals.cljs"],"mappings":";;;;AAIA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAgBM,AAA2BE;AAA3C,AAAA,AAAAP,AAAAD;AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAC,AAAA,AAAAD,AAAA,AAAA,AAAA,AAAA,AAAAE,AAAAC,AAAAH,AAAAA;AAAA,AAAAI,AAAAJ,AAAA,AAAsCM;AAAtC,AAIE,AAAAE,AACUD,AACA,AAAA,AAAA,AAAA,AAACI,AACD,AAAA,AAAA,AAAA,AAACC,AAAwB,AAACC,AACD,AAAAC;AAJnCN,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAP,AAAA,AAAAO,AAAA,AAAA,AAAA,AAAA,AAAAN,AAAAC,AAAAK,AAAAA;AAAAA,AAA2BE;AAA3B,AAAAN,AAAAI,AAAA,AAAcC;AAAd,AAKE,AAAA,AAAA,AAACM,AAAMT,AAAGU,AAAiBP,AAAIC;;AALjC,AAAA,AAAA,AAAA,AAMkBD,AACC,AAAA,AAAUF,AAAME;;AAErC,AAAA,AAAAQ,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAgBK;AAAhB,AAAA,AAAAL;;AAAA,AAAAC,AAAAC;AAAA,AAAA,AAAAC,AAAAF;AAAAE,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAApB,AAAA,AAAAoB,AAAA,AAAA,AAAA,AAAA,AAAAnB,AAAAC,AAAAkB,AAAAA;AAAA,AAAAjB,AAAAiB,AAAA,AAAoCf;AAApCgB,AAAAF;AAAAE,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAArB,AAAA,AAAAqB,AAAA,AAAA,AAAA,AAAA,AAAApB,AAAAC,AAAAmB,AAAAA;AAAA,AAAAlB,AAAAkB,AAAA,AAAiDb;AAAjD,AAGE,AAAA,AAAAe,AAAA,AAAA,AAACC,AAAQnB,AAAWG;;AAEtB,AAAA,AAAAQ,AAAA,AAAA,AAAA,AAAAS,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAgBG;AAAhB,AAAA,AAAAH;;AAAA,AAAAC,AAAyCG;AAAzC,AAAA,AAAAF,AAAAD;AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA3B,AAAA,AAAA2B,AAAA,AAAA,AAAA,AAAA,AAAA1B,AAAAC,AAAAyB,AAAAA;AAAA,AAAAxB,AAAAwB,AAAA,AAAoCtB;AAApC,AAAA,AAAA,AAEa,AAACyB,AAAK,AAAA,AAAAP,AAAA,AAACpB,AAAKE;;AAEzB,AAAA,AAAK0B,AAAc3B,AAAYkB,AAAUM;AAEzC,AAAKI,AACH,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAACC,AAC2CC,AACAC,AACAC,AACAC,AAGD,AAAA,AAACC,AAC7BC,AACC,AAAA,AAAA,AAACC,AAAiCT,AAClCU,AACAC","names":["com.wsscode.pathom.connect/mutation","p__52848","map__52849","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","com.wsscode.pathom.book.connect.mutation-join-globals/user-create","db","user","map__52851","id","new-user","cljs.core/select-keys","cljs.core.merge","cljs.core/random-uuid","js/Date","cljs.core.swap_BANG_","cljs.core/assoc-in","com.wsscode.pathom.connect/resolver","G__52853","p__52854","p__52855","map__52856","map__52857","com.wsscode.pathom.book.connect.mutation-join-globals/user-data","cljs.core/deref","cljs.core.get_in","G__52860","p__52861","map__52862","com.wsscode.pathom.book.connect.mutation-join-globals/all-users","_","cljs.core/vals","com.wsscode.pathom.book.connect.mutation-join-globals/app-registry","com.wsscode.pathom.book.connect.mutation-join-globals/parser","com.wsscode.pathom.core/parser","com.wsscode.pathom.core/map-reader","com.wsscode.pathom.connect/reader2","com.wsscode.pathom.connect/open-ident-reader","com.wsscode.pathom.core/env-placeholder-reader","cljs.core.atom","com.wsscode.pathom.connect/mutate","com.wsscode.pathom.connect.connect_plugin","com.wsscode.pathom.core/error-handler-plugin","com.wsscode.pathom.core/trace-plugin"],"sourcesContent":["(ns com.wsscode.pathom.book.connect.mutation-join-globals\n  (:require [com.wsscode.pathom.connect :as pc]\n            [com.wsscode.pathom.core :as p]))\n\n(pc/defmutation user-create [{::keys [db]} user]\n  {::pc/sym    'user/create\n   ::pc/params [:user/name :user/email]\n   ::pc/output [:user/id]}\n  (let [{:keys [user/id] :as new-user}\n        (-> user\n            (select-keys [:user/name :user/email])\n            (merge {:user/id         (random-uuid)\n                    :user/created-at (js/Date.)}))]\n    (swap! db assoc-in [:users id] new-user)\n    {:user/id       id\n     :app/id-remaps {(:user/id user) id}}))\n\n(pc/defresolver user-data [{::keys [db]} {:keys [user/id]}]\n  {::pc/input  #{:user/id}\n   ::pc/output [:user/id :user/name :user/email :user/created-at]}\n  (get-in @db [:users id]))\n\n(pc/defresolver all-users [{::keys [db]} _]\n  {::pc/output [{:user/all [:user/id :user/name :user/email :user/created-at]}]}\n  {:user/all (vals (get @db :users))})\n\n(def app-registry [user-create user-data all-users])\n\n(def parser\n  (p/parser\n    {::p/env     {::p/reader                 [p/map-reader\n                                              pc/reader2\n                                              pc/open-ident-reader\n                                              p/env-placeholder-reader]\n                  ::pc/mutation-join-globals [:app/id-remaps]\n                  ::p/placeholder-prefixes   #{\">\"}\n                  ::db                       (atom {})}\n     ::p/mutate  pc/mutate\n     ::p/plugins [(pc/connect-plugin {::pc/register app-registry})\n                  p/error-handler-plugin\n                  p/trace-plugin]}))\n"]}