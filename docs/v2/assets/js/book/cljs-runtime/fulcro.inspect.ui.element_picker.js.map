{"version":3,"sources":["fulcro/inspect/ui/element_picker.cljs"],"mappings":"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","names":["js/fulcro","js/fulcro.inspect","js/fulcro.inspect.ui","js/fulcro.inspect.ui.element-picker","js/fulcro.inspect.ui.element-picker.MarkerCSS","this__56082__auto__","js/React.Component","goog.object/extend","js/React.Component.prototype","fulcro.client.primitives/default-component-prototype","fulcro.client.primitives/-register-component!","x57994","this__55000__auto__","*reconciler*-orig-val__57997","fulcro.client.primitives/*reconciler*","*depth*-orig-val__57998","fulcro.client.primitives/*depth*","*shared*-orig-val__57999","fulcro.client.primitives/*shared*","*instrument*-orig-val__58000","fulcro.client.primitives/*instrument*","*parent*-orig-val__58001","fulcro.client.primitives/*parent*","*reconciler*-temp-val__58002","fulcro.client.primitives/get-reconciler","*depth*-temp-val__58003","fulcro.client.primitives/depth","*shared*-temp-val__58004","fulcro.client.primitives.shared","*instrument*-temp-val__58005","fulcro.client.primitives/instrument","*parent*-temp-val__58006","fulcro.client.primitives/props","x58022","cljs.core/PROTOCOL_SENTINEL","_","x58032","this__56085__auto__","writer__56086__auto__","opt__56087__auto__","cljs.core/-write","fulcro.inspect.ui.element-picker/MarkerCSS","fulcro.inspect.ui.element-picker/marker-element","id","or__4131__auto__","js/document.getElementById","G__58040","js/document.createElement","goog.object/set","fulcro-css.css/get-classnames","goog.dom/appendChild","js/document.body","fulcro.inspect.ui.element-picker/marker-label-element","G__58048","fulcro.inspect.ui.element-picker/react-raw-instance","node","temp__5718__auto__","instance-key","goog.object/getKeys","p1__58052#","cljs.core.filter","clojure.string/starts-with?","cljs.core/first","goog.object/get","fulcro.inspect.ui.element-picker/react-instance","raw","goog.object/getValueByKeys","fulcro.inspect.ui.element-picker/ensure-reconciler","x","app-uuid","e58076","G__58080","fulcro.client.primitives/app-state","cljs.core/deref","cljs.core._EQ_","p__58086","map__58087","cljs.core.apply","cljs.core/hash-map","cljs.core.get","fulcro.inspect.ui.element-picker/pick-element","on-pick","cljs.core/identity","marker","marker-label","current","cljs.core.atom","over-handler","e","target","instance","G__58091","cljs.core/reset!","goog.dom/setTextContent","fulcro.inspect.ui.helpers/react-display-name","target'","js/ReactDOM.findDOMNode","offset","goog.style/getPageOffset","size","goog.style/getSize","goog.style/setStyle","goog.dom/getParentElement","pick-handler","G__58102","js/removeEventListener","self","js/addEventListener","js/setTimeout","fulcro.inspect.ui.element-picker/inspect-component","comp","G__58116","e58117","fulcro.client.primitives.get_ident","e58119","G__58121","fulcro.client.primitives/react-type","fulcro.client.primitives.get_query"],"sourcesContent":["(ns fulcro.inspect.ui.element-picker\n  (:require [clojure.string :as str]\n            [fulcro-css.css :as css]\n            [goog.object :as gobj]\n            [goog.dom :as gdom]\n            [goog.style :as gstyle]\n            [fulcro.client.dom]\n            [fulcro.client.primitives :as fp :refer [get-query]]\n            [fulcro.inspect.ui.helpers :as ui.h]\n            [fulcro.inspect.remote.transit :as encode]))\n\n(fp/defsc MarkerCSS [_ _]\n  {:css [[:.container {:position       \"absolute\"\n                       :display        \"none\"\n                       :background     \"rgba(67, 132, 208, 0.5)\"\n                       :pointer-events \"none\"\n                       :overflow       \"hidden\"\n                       :color          \"#fff\"\n                       :padding        \"3px 5px\"\n                       :box-sizing     \"border-box\"\n                       :font-family    \"monospace\"\n                       :font-size      \"12px\"\n                       :z-index        \"999999\"}]\n\n         [:.label {:position       \"absolute\"\n                   :display        \"none\"\n                   :pointer-events \"none\"\n                   :box-sizing     \"border-box\"\n                   :font-family    \"sans-serif\"\n                   :font-size      \"10px\"\n                   :z-index        \"999999\"\n\n                   :background     \"#333740\"\n                   :border-radius  \"3px\"\n                   :padding        \"6px 8px\"\n                   ;:color          \"#ee78e6\"\n                   :color          \"#ffab66\"\n                   :font-weight    \"bold\"\n                   :white-space    \"nowrap\"}\n          [:&:before {:content      \"\\\"\\\"\"\n                      :position     \"absolute\"\n                      :top          \"24px\"\n                      :left         \"9px\"\n                      :width        \"0\"\n                      :height       \"0\"\n                      :border-left  \"8px solid transparent\"\n                      :border-right \"8px solid transparent\"\n                      :border-top   \"8px solid #333740\"}]]]})\n\n(defn marker-element []\n  (let [id \"__fulcro_inspect_marker\"]\n    (or (js/document.getElementById id)\n        (doto (js/document.createElement \"div\")\n          (gobj/set \"id\" id)\n          (gobj/set \"className\" (-> MarkerCSS css/get-classnames :container))\n          (->> (gdom/appendChild js/document.body))))))\n\n(defn marker-label-element []\n  (let [id \"__fulcro_inspect_marker_label\"]\n    (or (js/document.getElementById id)\n        (doto (js/document.createElement \"div\")\n          (gobj/set \"id\" id)\n          (gobj/set \"className\" (-> MarkerCSS css/get-classnames :label))\n          (->> (gdom/appendChild js/document.body))))))\n\n(defn react-raw-instance [node]\n  (if-let [instance-key (->> (gobj/getKeys node)\n                             (filter #(str/starts-with? % \"__reactInternalInstance$\"))\n                             (first))]\n    (gobj/get node instance-key)))\n\n(defn react-instance [node]\n  (if-let [raw (react-raw-instance node)]\n    (or (gobj/getValueByKeys raw \"_currentElement\" \"_owner\" \"_instance\") ; react < 16\n        (gobj/getValueByKeys raw \"return\" \"stateNode\") ; react >= 16\n        )))\n\n(defn ensure-reconciler [x app-uuid]\n  (try\n    (when (some-> (fp/get-reconciler x) fp/app-state deref\n            :fulcro.inspect.core/app-uuid (= app-uuid))\n      x)\n    (catch :default _)))\n\n(defn pick-element [{::keys                    [on-pick]\n                     :fulcro.inspect.core/keys [app-uuid]\n                     :or                       {on-pick identity}}]\n  (let [marker       (marker-element)\n        marker-label (marker-label-element)\n        current      (atom nil)\n        over-handler (fn [e]\n                       (let [target (.-target e)]\n                         (loop [target target]\n                           (if target\n                             (if-let [instance (some-> target react-instance (ensure-reconciler app-uuid))]\n                               (do\n                                 (.stopPropagation e)\n                                 (reset! current instance)\n                                 (gdom/setTextContent marker-label (ui.h/react-display-name instance))\n\n                                 (let [target' (js/ReactDOM.findDOMNode instance)\n                                       offset  (gstyle/getPageOffset target')\n                                       size    (gstyle/getSize target')]\n                                   (gstyle/setStyle marker-label\n                                     #js {:left (str (.-x offset) \"px\")\n                                          :top  (str (- (.-y offset) 36) \"px\")})\n\n                                   (gstyle/setStyle marker\n                                     #js {:width  (str (.-width size) \"px\")\n                                          :height (str (.-height size) \"px\")\n                                          :left   (str (.-x offset) \"px\")\n                                          :top    (str (.-y offset) \"px\")})))\n                               (recur (gdom/getParentElement target)))))))\n        pick-handler (fn self []\n                       (on-pick @current)\n\n                       (gstyle/setStyle marker #js {:display \"none\"})\n                       (gstyle/setStyle marker-label #js {:display \"none\"})\n\n                       (js/removeEventListener \"click\" self)\n                       (js/removeEventListener \"mouseover\" over-handler))]\n\n    (gstyle/setStyle marker #js {:display \"block\"\n                                 :top     \"-100000px\"\n                                 :left    \"-100000px\"})\n\n    (gstyle/setStyle marker-label #js {:display \"block\"\n                                       :top     \"-100000px\"\n                                       :left    \"-100000px\"})\n\n    (js/addEventListener \"mouseover\" over-handler)\n\n    (js/setTimeout\n      #(js/addEventListener \"click\" pick-handler)\n      10)))\n\n(defn inspect-component [comp]\n  {:fulcro.inspect.ui.element/display-name (some-> comp ui.h/react-display-name)\n   :fulcro.inspect.ui.element/props        (fp/props comp)\n   :fulcro.inspect.ui.element/ident        (try\n                                             (fp/get-ident comp)\n                                             (catch :default _ nil))\n   :fulcro.inspect.ui.element/query        (try\n                                             (some-> comp fp/react-type fp/get-query)\n                                             (catch :default _ nil))})\n"]}