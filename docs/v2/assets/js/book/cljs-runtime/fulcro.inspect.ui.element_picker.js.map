{"version":3,"sources":["fulcro/inspect/ui/element_picker.cljs"],"mappings":"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","names":["js/fulcro","js/fulcro.inspect","js/fulcro.inspect.ui","js/fulcro.inspect.ui.element-picker","js/fulcro.inspect.ui.element-picker.MarkerCSS","this__55957__auto__","js/React.Component","G__57159","G__57160","js/React.Component.prototype","G__57161","fulcro.client.primitives/default-component-prototype","goog.object/extend","fulcro.client.primitives/-register-component!","x57166","this__54322__auto__","*reconciler*-orig-val__57176","fulcro.client.primitives/*reconciler*","*depth*-orig-val__57177","fulcro.client.primitives/*depth*","*shared*-orig-val__57178","fulcro.client.primitives/*shared*","*instrument*-orig-val__57179","fulcro.client.primitives/*instrument*","*parent*-orig-val__57180","fulcro.client.primitives/*parent*","*reconciler*-temp-val__57181","fulcro.client.primitives/get-reconciler","*depth*-temp-val__57182","fulcro.client.primitives/depth","*shared*-temp-val__57183","fulcro.client.primitives.shared.cljs$core$IFn$_invoke$arity$1","*instrument*-temp-val__57184","fulcro.client.primitives/instrument","*parent*-temp-val__57185","fulcro.client.primitives/props","x57195","cljs.core/PROTOCOL_SENTINEL","_","x57204","this__55960__auto__","writer__55961__auto__","opt__55962__auto__","cljs.core/-write","fulcro.inspect.ui.element-picker/MarkerCSS","fulcro.inspect.ui.element-picker/marker-element","id","or__4131__auto__","js/document.getElementById","G__57207","G__57208","G__57209","G__57210","js/document.createElement","goog.object/set","fulcro-css.css/get-classnames","goog.dom/appendChild","js/document.body","fulcro.inspect.ui.element-picker/marker-label-element","G__57216","G__57217","G__57218","G__57219","fulcro.inspect.ui.element-picker/react-raw-instance","node","temp__5718__auto__","instance-key","goog.object/getKeys","p1__57220#","cljs.core.filter.cljs$core$IFn$_invoke$arity$2","clojure.string/starts-with?","cljs.core/first","goog.object/get","fulcro.inspect.ui.element-picker/react-instance","raw","goog.object/getValueByKeys","fulcro.inspect.ui.element-picker/ensure-reconciler","x","app-uuid","e57228","G__57229","fulcro.client.primitives/app-state","cljs.core/deref","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","p__57234","map__57235","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$3","cljs.core.get.cljs$core$IFn$_invoke$arity$2","fulcro.inspect.ui.element-picker/pick-element","on-pick","cljs.core/identity","marker","marker-label","current","cljs.core.atom.cljs$core$IFn$_invoke$arity$1","over-handler","e","target","instance","G__57242","cljs.core/reset!","G__57246","G__57247","goog.dom/setTextContent","fulcro.inspect.ui.helpers/react-display-name","target'","js/ReactDOM.findDOMNode","offset","goog.style/getPageOffset","size","goog.style/getSize","G__57248","G__57249","goog.style/setStyle","G__57250","G__57251","goog.dom/getParentElement","pick-handler","G__57255","G__57256","G__57257","G__57261","G__57262","js/removeEventListener","self","G__57268","G__57269","G__57274","G__57275","js/addEventListener","js/setTimeout","fulcro.inspect.ui.element-picker/inspect-component","comp","G__57281","e57283","fulcro.client.primitives.get_ident.cljs$core$IFn$_invoke$arity$1","e57284","G__57285","fulcro.client.primitives/react-type","fulcro.client.primitives.get_query.cljs$core$IFn$_invoke$arity$1"],"sourcesContent":["(ns fulcro.inspect.ui.element-picker\n  (:require [clojure.string :as str]\n            [fulcro-css.css :as css]\n            [goog.object :as gobj]\n            [goog.dom :as gdom]\n            [goog.style :as gstyle]\n            [fulcro.client.dom]\n            [fulcro.client.primitives :as fp :refer [get-query]]\n            [fulcro.inspect.ui.helpers :as ui.h]\n            [fulcro.inspect.remote.transit :as encode]))\n\n(fp/defsc MarkerCSS [_ _]\n  {:css [[:.container {:position       \"absolute\"\n                       :display        \"none\"\n                       :background     \"rgba(67, 132, 208, 0.5)\"\n                       :pointer-events \"none\"\n                       :overflow       \"hidden\"\n                       :color          \"#fff\"\n                       :padding        \"3px 5px\"\n                       :box-sizing     \"border-box\"\n                       :font-family    \"monospace\"\n                       :font-size      \"12px\"\n                       :z-index        \"999999\"}]\n\n         [:.label {:position       \"absolute\"\n                   :display        \"none\"\n                   :pointer-events \"none\"\n                   :box-sizing     \"border-box\"\n                   :font-family    \"sans-serif\"\n                   :font-size      \"10px\"\n                   :z-index        \"999999\"\n\n                   :background     \"#333740\"\n                   :border-radius  \"3px\"\n                   :padding        \"6px 8px\"\n                   ;:color          \"#ee78e6\"\n                   :color          \"#ffab66\"\n                   :font-weight    \"bold\"\n                   :white-space    \"nowrap\"}\n          [:&:before {:content      \"\\\"\\\"\"\n                      :position     \"absolute\"\n                      :top          \"24px\"\n                      :left         \"9px\"\n                      :width        \"0\"\n                      :height       \"0\"\n                      :border-left  \"8px solid transparent\"\n                      :border-right \"8px solid transparent\"\n                      :border-top   \"8px solid #333740\"}]]]})\n\n(defn marker-element []\n  (let [id \"__fulcro_inspect_marker\"]\n    (or (js/document.getElementById id)\n        (doto (js/document.createElement \"div\")\n          (gobj/set \"id\" id)\n          (gobj/set \"className\" (-> MarkerCSS css/get-classnames :container))\n          (->> (gdom/appendChild js/document.body))))))\n\n(defn marker-label-element []\n  (let [id \"__fulcro_inspect_marker_label\"]\n    (or (js/document.getElementById id)\n        (doto (js/document.createElement \"div\")\n          (gobj/set \"id\" id)\n          (gobj/set \"className\" (-> MarkerCSS css/get-classnames :label))\n          (->> (gdom/appendChild js/document.body))))))\n\n(defn react-raw-instance [node]\n  (if-let [instance-key (->> (gobj/getKeys node)\n                             (filter #(str/starts-with? % \"__reactInternalInstance$\"))\n                             (first))]\n    (gobj/get node instance-key)))\n\n(defn react-instance [node]\n  (if-let [raw (react-raw-instance node)]\n    (or (gobj/getValueByKeys raw \"_currentElement\" \"_owner\" \"_instance\") ; react < 16\n        (gobj/getValueByKeys raw \"return\" \"stateNode\") ; react >= 16\n        )))\n\n(defn ensure-reconciler [x app-uuid]\n  (try\n    (when (some-> (fp/get-reconciler x) fp/app-state deref\n            :fulcro.inspect.core/app-uuid (= app-uuid))\n      x)\n    (catch :default _)))\n\n(defn pick-element [{::keys                    [on-pick]\n                     :fulcro.inspect.core/keys [app-uuid]\n                     :or                       {on-pick identity}}]\n  (let [marker       (marker-element)\n        marker-label (marker-label-element)\n        current      (atom nil)\n        over-handler (fn [e]\n                       (let [target (.-target e)]\n                         (loop [target target]\n                           (if target\n                             (if-let [instance (some-> target react-instance (ensure-reconciler app-uuid))]\n                               (do\n                                 (.stopPropagation e)\n                                 (reset! current instance)\n                                 (gdom/setTextContent marker-label (ui.h/react-display-name instance))\n\n                                 (let [target' (js/ReactDOM.findDOMNode instance)\n                                       offset  (gstyle/getPageOffset target')\n                                       size    (gstyle/getSize target')]\n                                   (gstyle/setStyle marker-label\n                                     #js {:left (str (.-x offset) \"px\")\n                                          :top  (str (- (.-y offset) 36) \"px\")})\n\n                                   (gstyle/setStyle marker\n                                     #js {:width  (str (.-width size) \"px\")\n                                          :height (str (.-height size) \"px\")\n                                          :left   (str (.-x offset) \"px\")\n                                          :top    (str (.-y offset) \"px\")})))\n                               (recur (gdom/getParentElement target)))))))\n        pick-handler (fn self []\n                       (on-pick @current)\n\n                       (gstyle/setStyle marker #js {:display \"none\"})\n                       (gstyle/setStyle marker-label #js {:display \"none\"})\n\n                       (js/removeEventListener \"click\" self)\n                       (js/removeEventListener \"mouseover\" over-handler))]\n\n    (gstyle/setStyle marker #js {:display \"block\"\n                                 :top     \"-100000px\"\n                                 :left    \"-100000px\"})\n\n    (gstyle/setStyle marker-label #js {:display \"block\"\n                                       :top     \"-100000px\"\n                                       :left    \"-100000px\"})\n\n    (js/addEventListener \"mouseover\" over-handler)\n\n    (js/setTimeout\n      #(js/addEventListener \"click\" pick-handler)\n      10)))\n\n(defn inspect-component [comp]\n  {:fulcro.inspect.ui.element/display-name (some-> comp ui.h/react-display-name)\n   :fulcro.inspect.ui.element/props        (fp/props comp)\n   :fulcro.inspect.ui.element/ident        (try\n                                             (fp/get-ident comp)\n                                             (catch :default _ nil))\n   :fulcro.inspect.ui.element/query        (try\n                                             (some-> comp fp/react-type fp/get-query)\n                                             (catch :default _ nil))})\n"]}