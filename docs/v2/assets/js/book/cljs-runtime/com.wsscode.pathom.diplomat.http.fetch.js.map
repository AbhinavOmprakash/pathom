{"version":3,"sources":["com/wsscode/pathom/diplomat/http/fetch.cljs"],"mappings":"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","names":["p__48859","map__48860","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","com.wsscode.pathom.diplomat.http.fetch/build-headers","headers","content-type","base-headers","G__48864","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","com.wsscode.pathom.diplomat.http/encode-type->header","cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic","p__48879","map__48880","com.wsscode.pathom.diplomat.http.fetch/build-body","form-params","G__48890","cljs.core/Keyword","js/JSON.stringify","cljs.core/clj->js","p__48918","map__48919","com.wsscode.pathom.diplomat.http.fetch/normalize-as","as","req","G__48926","cljs.core.assoc.cljs$core$IFn$_invoke$arity$variadic","p__48931","map__48935","com.wsscode.pathom.diplomat.http.fetch/build-request-map","G__48942","com.wsscode.pathom.diplomat.http/request-method","p__48955","map__48956","com.wsscode.pathom.diplomat.http.fetch/request-async","url","cljs.spec.alpha/*compile-asserts*","cljs.core/deref","cljs.spec.alpha/*runtime-asserts*","cljs.spec.alpha/assert*","c__38971__auto__","cljs.core.async.chan.cljs$core$IFn$_invoke$arity$1","cljs.core.async.impl.dispatch/run","f__38972__auto__","switch__38924__auto__","state_49075","state_val_49076","inst_49011","statearr-49087","statearr-49097","inst_49034","inst_49057","inst_49064","inst_49065","inst_49066","cljs.core/PersistentHashMap","inst_49067","statearr-49101","statearr-49102","inst_48992","_","cljs.core.async.impl.ioc-helpers/add-exception-frame","inst_48995","inst_48996","cljs.core/not","statearr-49105","statearr-49108","statearr-49109","inst_49038","inst_49053","inst_49054","inst_49055","inst_49059","inst_49060","inst_49061","inst_49062","statearr-49113","statearr-49115","statearr-49116","statearr-49117","inst_49016","inst_49017","inst_49018","inst_49019","inst_49020","inst_49021","inst_49022","inst_49023","inst_49024","inst_49025","inst_49027","inst_49028","inst_49029","inst_49030","com.wsscode.common.async-cljs/promise->chan","statearr-49122","cljs.core.async.impl.ioc-helpers/take!","inst_49070","inst_49071","statearr-49125","statearr-49126","cljs.core.async.impl.ioc-helpers/process-exception","statearr-49128","inst_49042","inst_49043","com.wsscode.common.async-cljs/consumer-pair","inst_49044","statearr-49135","inst_48982","statearr-49137","statearr-49141","inst_49073","cljs.core.async.impl.ioc-helpers/return-chan","inst_49049","inst_49050","statearr-49146","inst_49013","statearr-49148","statearr-49149","inst_49000","inst_49001","inst_49002","inst_49003","inst_49004","statearr-49152","statearr-49154","inst_49033","inst_49032","statearr-49160","G__49165","statearr-49179","statearr-49181","inst_49039","inst_49040","inst_49008","statearr-49183","inst_49046","inst_49047","statearr-49185","statearr-49191","state-machine__38925__auto__","ret-value__38926__auto__","result__38927__auto__","cljs.core/keyword-identical?","e49193","js/Object","ex__38928__auto__","statearr-49194","state__38973__auto__","statearr-49199","cljs.core.async.impl.ioc-helpers/USER-START-IDX","cljs.core.async.impl.ioc-helpers/run-state-machine-wrapped","com.wsscode.pathom.trace.trace_enter.cljs$core$IFn$_invoke$arity$2","clojure.string/upper-case","cljs.core/name","js/fetch","goog.object/get","cljs.core.js__GT_clj.cljs$core$IFn$_invoke$arity$variadic","com.wsscode.pathom.trace.trace_leave.cljs$core$IFn$_invoke$arity$3","com.wsscode.pathom.trace/trace-tree-collect","x","row","com.wsscode.pathom.trace/trace-style","com.wsscode.pathom.trace/tree-assoc-detail","com.wsscode.pathom.misc/INCLUDE_SPECS","cljs.spec.alpha/def-impl","cljs.spec.alpha/fspec-impl","cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4","cljs.core/any?","cljs.spec.alpha/cat-impl"],"sourcesContent":["(ns com.wsscode.pathom.diplomat.http.fetch\n  (:require [cljs.spec.alpha :as s]\n            [clojure.string :as str]\n            [com.wsscode.common.async-cljs :refer [let-chan <!p go-catch <? <?maybe]]\n            [com.wsscode.pathom.core :as p]\n            [com.wsscode.pathom.diplomat.http :as http]\n            [com.wsscode.pathom.misc :as p.misc]\n            [com.wsscode.pathom.trace :as pt]\n            [goog.object :as gobj]))\n\n(defn build-headers [{::http/keys [headers content-type]}]\n  (let [base-headers\n        (cond-> nil\n          content-type (assoc :content-type (http/encode-type->header content-type)))]\n    (merge base-headers headers)))\n\n(defn build-body [{::http/keys [form-params content-type]}]\n  (case content-type\n    ::http/json (js/JSON.stringify (clj->js form-params))\n    (str form-params)))\n\n(defn normalize-as [{::http/keys [as] :as req}]\n  (cond-> req\n    as (assoc ::http/content-type as ::http/accept as)))\n\n(defn build-request-map [{::http/keys [form-params] :as req}]\n  (let [req     (normalize-as req)\n        headers (build-headers req)]\n    (cond-> {:method (http/request-method req)}\n      headers (assoc :headers headers)\n      form-params (assoc :body (build-body req)))))\n\n(defn request-async [{::http/keys [url] :as req}]\n  (s/assert ::http/request req)\n  (go-catch\n    (let [{::http/keys [accept]} (normalize-as req)\n          method   (http/request-method req)\n          tid      (pt/trace-enter req {::pt/event ::http-request\n                                        ::pt/label (str (str/upper-case (name method)) \" \" url)\n                                        ::url      url\n                                        ::method   method})\n          response (<!p (js/fetch url (clj->js (build-request-map req))))\n          status   (gobj/get response \"status\")\n          out      {::http/status status\n                    ::http/body   (case accept\n                                    ::http/json (js->clj (<!p (.json response)) :keywordize-keys true)\n                                    (<!p (.text response)))}]\n      (pt/trace-leave req tid\n        (cond-> {} (not (< 199 status 300)) (assoc ::p/error {:status status})))\n      out)))\n\n(defmethod pt/trace-tree-collect ::http-request [x row]\n  (-> row\n      (pt/trace-style {:fill (if (::p/error row) \"#ff8181\" \"#73abff\")})\n      (pt/tree-assoc-detail x [::url ::method ::p/error])))\n\n(when p.misc/INCLUDE_SPECS\n  (s/fdef request-async\n    :args (s/cat :request ::http/request)))\n"]}